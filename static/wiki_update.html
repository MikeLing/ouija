<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<html>
<head>
     <script type="text/javascript">
        var platforms = ["android2.3","android4.0"];
        var pIndex = 0;
        
        //to calculate today's date
        var today = new Date(); //to get current day's date
        //console.log(today);
        var s_today = today.toISOString().split('T')[0];//gives YYYY-MM-DD form
        //console.log(s_today);
        //calculating the last week date 1 week ago
        var last_week = new Date(Date.now() - 7*24*60*60*1000);
        //console.log(last_week);
        s_last_week = last_week.toISOString().split('T')[0];
        //console.log(s_last_week);
        //calculating previous week's date 2 weeks ago
        var previous_week = new Date(last_week - 7*24*60*60*1000);
        //console.log(previous_week);
        s_previous_week = previous_week.toISOString().split('T')[0];
        //console.log(s_previous_week);
                
        
        function fetch_print(pIndex) {
            var android_version = "";
            if (pIndex < platforms.length) {
                android_version = platforms[pIndex];
            }
	    //first request which takes last week's and today's date  	 
            var request = new XMLHttpRequest();
            request.onload = function (e) {
                var raw = JSON.parse(request.response);
                var failRates = raw.failRates;
                var dates = raw.dates;
                
                // insert dates
                document.getElementById('s_last_week').innerHTML = dates.startDate;
                document.getElementById('s_today').innerHTML = dates.endDate;

                //Storing values of failrates
                document.getElementById('failure_rate'+android_version).innerHTML = failRates['failRateWithRetries'];
                document.getElementById('failure_exclude_retry'+android_version).innerHTML = failRates['failRate'];
            }
            request.open('get', '/data/platform?platform='+android_version,true);
            request.send();
            document.writeln("* " +android_version+" Total failure exclude retry rate: [[http://54.215.155.53/android_failures.html?platform=" +android_version+"  <span id=\"failure_rate"+android_version+"\"></span>%]]<br/>");
            document.writeln("** "+android_version+" Total failure exclude retry <span id=\"failure_exclude_retry"+android_version+"\"></span>%]]<br/>");
	    //second request which takes the week_before_last_week's date and last week's date  	 
            var request2 = new XMLHttpRequest();
            request2.onload = function2 (e) {
                var raw = JSON.parse(request.response);
                var failRates = raw.failRates;
                var dates = raw.dates;
                
                // insert dates
                document.getElementById('s_previous_week').innerHTML = dates.startDate;
                document.getElementById('s_last_week').innerHTML = dates.endDate;

                //Storing values of failrates
                document.getElementById('failure_rate'+android_version).innerHTML = failRates['failRateWithRetries'];
                document.getElementById('failure_exclude_retry'+android_version).innerHTML = failRates['failRate'];
            }
            request2.open('get', '/data/platform?platform='+android_version,true);
            request2.send();
            document.writeln("* " +android_version+" Total failure exclude retry rate: [[http://54.215.155.53/android_failures.html?platform=" +android_version+"  <span id=\"failure_rate"+android_version+"\"></span>%]]<br/>");
            document.writeln("** "+android_version+" Total failure exclude retry <span id=\"failure_exclude_retry"+android_version+"\"></span>%]]<br/>");
        }
        }
        do{
            fetch_print(pIndex);
            pIndex++;   
        }while (pIndex < platforms.length);
            </script>
</head>
<body>
    <div id="pageHeader"></div>
    <p>
        <strong>Data fetched for:</strong>
        <span id="startDate"></span> &mdash; <span id="endDate"></span>
    </p>
</body>
</html>
